<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="manage">
	<!-- <select id="selname" resultType="int" parameterType="empvo"> -->
	<!-- select count(*) cnt from employee where name=#{name} -->
	<!-- </select> -->

	<!-- <select id="selposition" resultType="int" parameterType="empvo"> -->
	<!-- select count(*) cnt from employee where position=#{position} -->
	<!-- </select> -->


	<!-- <select id="seldept" resultType="int" parameterType="deptvo"> -->
	<!-- select count(*) cnt from department where name=#{name} -->
	<!-- </select> -->
	<!-- <select id="selname" resultType="empvo" parameterType="empvo"> -->
	<!-- select name,name,position,tel -->
	<!-- from employee natural join department -->
	<!-- where name LIKE '%'||#{searchValue}||'%' -->
	<!-- </select> -->

	<!-- <select id="selposition" resultType="empvo" parameterType="empvo"> -->
	<!-- select name,name,position,tel -->
	<!-- from employee natural join department -->
	<!-- where position LIKE '%'||#{searchValue}||'%' -->
	<!-- </select> -->


	<!-- <select id="seldept" resultType="deptvo" parameterType="deptvo"> -->
	<!-- count(*) cnt from department where name=#{name} -->
	<!-- select name,name,position,tel -->
	<!-- from employee natural join department -->
	<!-- where name LIKE '%'||#{searchValue}||'%' -->
	<!-- </select> -->
	<select id="getlistsearch" resultType="empvo" parameterType="searchVO">
		select * from
		(
		select a.*, rownum as r_num from
		(
		select emp.name ename,
		emp.position position, emp.tel tel, dept.name
		dname
		from employee
		emp, (select name, id from department) dept

		<if test="searchType != null">

			<where>
				emp.dept_id = dept.id
				<choose>
					<when test="searchType == 1">
						and emp.name LIKE '%'||#{searchValue}||'%'
					</when>
					<when test="searchType == 2">
						and emp.position LIKE '%'||#{searchValue}||'%'
					</when>
					<when test="searchType == 3">
						and dept.name LIKE '%'||#{searchValue}||'%'
					</when>
					<otherwise>

					</otherwise>
				</choose>
			</where>
		</if>

		) a
		)
		where r_num between #{begin} and #{end}



	</select>


	<select id="somecnt" resultType="int" parameterType="searchVO">
		<!-- 작성자1, 상품명2, 가격3 , 내용 등등 -->
		select count(*) cnt from employee em, department de  
		where em.DEPT_ID = de.ID
		<if test="searchType != null">
	
				<choose>
					<when test="searchType == 1">
						and em.name LIKE '%'||#{searchValue}||'%'
					</when>
					<when test="searchType == 2">
						and em.position LIKE '%'||#{searchValue}||'%'
					</when>
					<when test="searchType == 3">
						and de.name LIKE '%'||#{searchValue}||'%'
					</when>
					<otherwise>

					</otherwise>
				</choose>
			
		</if>
	
	</select>

	<select id="list" resultType="empvo" parameterType="searchVO">

		select
		ename,dname,position,tel
		from (
      select a.*, rownum as r_num from
      (
        select emp.name ename,
        emp.position position, emp.tel tel, dept.name
        dname
        from employee
        emp, (select name, id from department) dept
      )
      a
		) where r_num between
		#{begin} and #{end}

	</select>


	<select id="cnt" resultType="int">
		 select count(*) cnt from employee em, department de where em.DEPT_ID = de.ID
	</select>

	<select id="iew" parameterType="int" resultType="empvo">
		select * from employee em, department de where em.DEPT_ID = de.ID and dept_id = #{dept_id}
	</select>
</mapper>